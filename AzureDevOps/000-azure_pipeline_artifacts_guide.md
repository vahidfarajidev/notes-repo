# مقایسه روش‌های اجرای Azure DevOps Pipeline و مدیریت Artifactها

این مقاله چهار روش اصلی برای اجرای Azure DevOps pipeline و مدیریت Artifactها را بررسی می‌کند و توضیحات کاملی درباره Self-hosted agent و نحوه فعال‌سازی آن ارائه می‌دهد.

---

## ۰️⃣ همه چیز Cloud

- **توضیح:** تمام پروژه، pipeline، Artifact و Kubernetes روی Cloud اجرا می‌شوند.
- **ابزارها:**
  - Azure Artifacts برای مدیریت Artifact
  - Azure Kubernetes Service (AKS) برای اجرای اپلیکیشن
- **مزایا:**
  - ساده و سریع
  - نیاز به نصب و کانفیگ روی سیستم لوکال ندارد
- **معایب:**
  - ممکن است هزینه بالاتر باشد
  - کنترل کامل روی منابع لوکال وجود ندارد

---

## ۱️⃣ Cloud pipeline به لوکال وصل شود

- **توضیح:** Pipeline روی Azure-hosted agent اجرا می‌شود و Artifactها به سیستم لوکال ارسال می‌شوند.
- **مزایا:**
  - هنوز تعریف pipeline روی Cloud است
- **معایب:**
  - سیستم لوکال یا Nexus باید Public IP یا VPN داشته باشد
  - پیچیدگی شبکه و امنیت

---

## ۲️⃣ Cloud pipeline + Self-hosted agent لوکال

- **توضیح:**
  - YAML pipeline روی Cloud (Azure DevOps) باقی می‌ماند.
  - مراحل Build و Push روی **Self-hosted agent** اجرا می‌شوند که روی سیستم یا VM لوکال نصب شده است.

- **مزایا:**
  - دسترسی کامل به منابع لوکال مانند Nexus و Kubernetes
  - امن و قابل کنترل

- **نحوه فعال‌سازی Self-hosted agent:**
  1. به **Azure DevOps Project** خود بروید.
  2. از منوی سمت چپ به **Project Settings → Agent pools** بروید.
  3. یک **Agent Pool** ایجاد کنید یا از Default استفاده کنید.
  4. روی **New Agent** کلیک کنید و دستورالعمل نصب روی سیستم لوکال را دنبال کنید.
  5. پس از نصب و اجرا، pipeline می‌تواند روی این agent اجرا شود.

- **نمونه YAML برای استفاده از Self-hosted agent:**

```yaml
pool:
  name: 'Default'       # اسم Agent Pool
  demands:
    - agent.os -equals Linux
```

---

## ۳️⃣ همه چیز لوکال با VM / Azure server لوکال

- **توضیح:**
  - یک VM یا سرور روی سیستم لوکال راه‌اندازی می‌کنید.
  - Self-hosted agent، Nexus و Kubernetes همه روی همان VM اجرا می‌شوند.

- **مزایا:**
  - همه چیز آفلاین و لوکال اجرا می‌شود
  - تست کامل CI/CD بدون نیاز به اینترنت

- **معایب:**
  - نیاز به نصب و کانفیگ VM
  - شبیه‌سازی محیط Cloud ممکن است پیچیده باشد

---

## جمع‌بندی مقایسه روش‌ها

| روش | Pipeline | Agent | Artifact | مزایا | معایب |
|-----|---------|-------|----------|-------|-------|
| ۰ | Cloud | Azure-hosted | Azure Artifacts / AKS | ساده و سریع | هزینه بالاتر، کنترل کمتر روی لوکال |
| ۱ | Cloud | Azure-hosted | Nexus/K8s لوکال | تعریف pipeline روی Cloud | نیاز به دسترسی اینترنت، پیچیدگی شبکه |
| ۲ | Cloud | Self-hosted لوکال | Nexus/K8s لوکال | امن و عملی، دسترسی کامل لوکال | نیاز به نصب agent روی لوکال |
| ۳ | لوکال | Self-hosted روی VM | Nexus/K8s لوکال | کامل آفلاین، کنترل کامل | نیاز به VM و کانفیگ پیچیده |

---

💡 **نکته کلیدی:**
- روش ۲ رایج‌ترین و عملی‌ترین برای ترکیب Cloud و منابع لوکال است.
- روش ۳ مناسب زمانی است که می‌خواهید همه چیز کاملاً آفلاین و لوکال باشد.
- روش ۰ ساده‌ترین راه برای کسانی است که می‌خواهند همه چیز روی Cloud باشد.

---

این مقاله به شما کمک می‌کند تا با توجه به نیازهای پروژه خود، روش مناسب اجرای pipeline و مدیریت Artifactها را انتخاب کنید.

