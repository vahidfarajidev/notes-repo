## ๐ ุงูุฒูุฏู ูุฑุญููโ Deploy ุฎูุฏฺฉุงุฑ ุจู Azure App Service ุฏุฑ Pipeline

---

### ๐น ูุฑุญูู ฑณ โ ุงูุฒูุฏู ูุฑุญูู Deploy ุจู App Service (ุจุนุฏ ุงุฒ Push ุจู ACR)

ุฏุฑ ุญุงู ุญุงุถุฑุ Pipeline ุดูุง ุชุง ูุฑุญููโ **Push Docker Image ุจู Azure Container Registry (ACR)** ูพุด ูโุฑูุฏ.
ุฏุฑ ุงู ูุฑุญููุ ูุฏู ูุง ุงู ุงุณุช ฺฉู **Image ุฌุฏุฏ ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุฑู Azure App Service ูุณุชูุฑ ุดูุฏ**.

---

### โณ๏ธ ฺฏุงู ฑ โ ุงุถุงูู ฺฉุฑุฏู Task ุฌุฏุฏ ุจู YAML

ูุงู `azure-pipelines.yml` ุฑุง ุจุงุฒ ฺฉุฑุฏู ู ุงู ุจุฎุด ุฑุง **ุจุนุฏ ุงุฒ ูุฑุญููโ Push** ุงุถุงูู ฺฉูุฏ:

```yaml
- task: AzureWebAppContainer@2
  displayName: Deploy to Azure App Service (Docker)
  inputs:
    azureSubscription: $(azureResourceManagerServiceConnection)   # ููุงู Service Connection ุชุนุฑูโุดุฏู
    appName: $(appServiceName)         # ูุงู ูุงูุน App Service ุดูุง
    containers: '$(containerRegistry)/$(imageRepository):$(tag)' # ุชฺฏ ูุนูุงู ุซุงุจุช ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดุฏู ุงุณุช
```

---

### ๐ ุชูุถุญุงุช:

* **AzureWebAppContainer@1** ูุณุฆููุช ุฏุงุฑุฏ ุชุง Image ูุดุฎุตโุดุฏู ุฑุง ุงุฒ ACR ฺฏุฑูุชู ู ุฏุฑ App Service ูุณุชูุฑ ฺฉูุฏ.
* `containers` ูุณุฑ ฺฉุงูู Image ุฏุฑ ACR ุงุณุช โ  
  `azuredemoacr2873.azurecr.io/azuredemoapi:$(tag)`
* `$(tag)` ููุงู ููุฏุงุฑ ุงุณุช ฺฉู ุฏุฑ ูุฑุญูู Build/Push ุงุณุชูุงุฏู ุดุฏูุ ูพุณ ูุณุฎู ุฏูู Image ูุณุชูุฑ ุฎูุงูุฏ ุดุฏ.

---

### โณ๏ธ ฺฏุงู ฒ โ Commit ู Push ุชุบุฑุงุช

```powershell
git add azure-pipelines.yml
git commit -m "Add deploy to App Service step"
git push origin main
```

ุงฺฉููู ุจุง ุงุฌุฑุง Pipeline:

1. Image ุณุงุฎุชู ูโุดูุฏ โ
2. ุฏุฑ ACR ุฐุฎุฑู ูโุดูุฏ โ
3. ููุงู Image ุฑู Azure App Service ูุณุชูุฑ ูโุดูุฏ โ

---

๐ก ูุฏู ุจุนุฏ: ูุฑุญููโุง ุจุฑุง **ุชูุธู Environment Variables ู Secrets ุงุฒ Azure Key Vault** ุงุถุงูู ฺฉูู ุชุง ุจุฎุด ุงููุช CI/CD ุดูุง ฺฉุงููโุชุฑ ุดูุฏ.

---

# ุงููุช ูุฑุญูู Deploy ุฏุฑ YAML ุญุช ุจุง ุชฺฏ ุซุงุจุช

ุญุช ููุช ุงุฒ **ุชฺฏ ุซุงุจุช** ุงุณุชูุงุฏู ูโฺฉููุ ูุฑุญููโ **Deploy** ุฏุฑ pipeline ุญุงุช ุงุณุช. ุจุฏูู ุงู ูุฑุญููุ CI ฺฉุงูู ูู CD ูุงูุต ุฎูุงูุฏ ุจูุฏ.

---

## ๐น ฺุฑุง Deploy ูููุฒ ูุงุฒู ุงุณุชุ

1. **Push ุจู ACR โ Deploy ุจู App Service**
   * Pipeline ููุท Image ุฑุง ุจู **ACR** ูโูุฑุณุชุฏ.
   * App Service ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุขุฎุฑู Image ุฏุฑ ACR ุฑุง ููโฺฏุฑุฏ ูฺฏุฑ Manual Pull ุง Restart ุงูุฌุงู ุดูุฏ.

2. **ุจุฏูู Deploy ุฏุฑ pipeline**
   * App Service ุจุง ูุฑ Push ุชุบุฑ ููโฺฉูุฏ.
   * ูุงุฒ ุจู ูุฑูุฏ ุจู Portal ุง Restart ุฏุณุช ุจุฑุง Pull Image ุฌุฏุฏ ุงุณุช.

3. **ุญุช ุจุง ุชฺฏ ุซุงุจุช (`1.0.0`)**
   * Push ุฌุฏุฏ ููุท Image ูุจู ุฑุง ุฏุฑ ACR overwrite ูโฺฉูุฏ.
   * App Service ุชุง ุงุฌุฑุง Deployุ ููฺูุงู ุงุฒ ูุณุฎู ูุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ.
   * ูุฑุญูู Deploy App Service ุฑุง ุจู ุขุฎุฑู Image ุขูพุฏุช ูโฺฉูุฏ.

---

## ๐น ุฌุฑุงู ุฏูู

1. App Service **container image ุจุง ุชฺฏ ูุดุฎุต** ุฑุง ฺฉ ุจุงุฑ ุฏุฑ ุฒูุงู Start ุง Restart Pull ูโฺฉูุฏ.
2. Docker / App Service ุชฺฏ ุซุงุจุช ุฑุง **immutable** ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ.
3. ุงฺฏุฑ Image ุฏุฑ registry ุขูพุฏุช ุดูุฏ ุงูุง App Service ุฑุณุชุงุฑุช ูุดูุฏุ ููฺูุงู ูุณุฎู ูุฏู ุงุฌุฑุง ูโุดูุฏ.

---

## ๐น ุฑุงูฺฉุงุฑูุง ุจุฑุง Deploy ุฎูุฏฺฉุงุฑ

1. ุงุถุงูู ฺฉุฑุฏู ูุฑุญูู Deploy ุฏุฑ pipeline (`AzureWebAppContainer@2`) โ Pull ู ุฑุณุชุงุฑุช ุงุชููุงุชฺฉ ุงูุฌุงู ูโุดูุฏ.
2. ุงุณุชูุงุฏู ุงุฒ ุชฺฏ ูพูุง (`1.0.$(Build.BuildId)`) โ App Service ุจุง ุชฺฏ ุฌุฏุฏ ุฎูุฏุด Pull ูโฺฉูุฏ.

---

## ๐น ุฌูุนโุจูุฏ ฺฉูุชุงู

| ุญุงูุช                         | ูุชุฌู                                                       |
| ---------------------------- | ----------------------------------------------------------- |
| ุชฺฏ ุซุงุจุช ู Push ุจุฏูู Deploy   | App Service ูุณุฎู ูุฏู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ โ ูุงุฒ ุจู Restart    |
| ุชฺฏ ุซุงุจุช ู Deploy ุฏุฑ pipeline | App Service ูุณุฎู ุฌุฏุฏ ุฑุง Pull ู ุงุฌุฑุง ูโฺฉูุฏ โ             |
| ุชฺฏ ูพูุง ู Deploy             | App Service ุฎูุฏฺฉุงุฑ ูุณุฎู ุฌุฏุฏ ุฑุง Pull ูโฺฉูุฏ โ             |

**ูุชุฌู:** ุญุช ุจุง ุชฺฏ ุซุงุจุชุ **ุฑโุงุณุชุงุฑุช ุง ุงุฌุฑุง Deploy ุฏุฑ pipeline ุถุฑูุฑ ุงุณุช** ุชุง ุขุฎุฑู Image ุฏุฑ App Service ุงุฌุฑุง ุดูุฏ.



