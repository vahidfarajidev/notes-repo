# ุฌูุนโุจูุฏ ุฎุทุงูุง ู ุฑุงูโุญูโูุง ุจุฑุง Azure App Service

### โ ูุณุช ุฎุทุงูุง ู ุฑุงูโุญูโูุง

**ฑ. Settings โ Configuration โ Container Settings ูุจูุฏ**

* **ุฏูู:** App Service ุฌุฏุฏ ุฏุฑ Portal ุฌุฏุฏุ ูุณุฑ ูุฏู Configuration โ Container Settings ูุฌูุฏ ูุฏุงุดุช
* **ุฑุงูโุญู:** ุงุฒ **ุจุฎุด Search ุฏุฑ Azure Portal**ุ App Service ุฎูุฏ ุฑุง ูพุฏุง ฺฉุฑุฏู ู ุจุงุฒ ฺฉุฑุฏูุ ุณูพุณ ูุงุฑุฏ ุจุฎุด **Container Settings** ุดุฏู. ฺฉุงูุชูุฑ ุงุตู (`main`) ุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏู ู ูพุงุฑุงูุชุฑูุง ุฒุฑ ุฑุง ุณุช ฺฉุฑุฏู:

  * **Image:** `azuredemoapi:1.0.0`
  * **Registry:** `azuredemoacr2873`
  * **Port:** `80`
  * **Identity:** `System Assigned`
    ุจุนุฏ Save ู Restart App Service ุดุฏ ุชุง ุชุบุฑุงุช ุงุนูุงู ุดูุฏ

**ฒ. ุฎุทุง Application Error ุฑู `/api/hello`**

* **ุฏูู:** ุงุฒ ุฑู **Log Stream** ูุชูุฌู ุดุฏู ฺฉู ูพูุฑุช ุฏุงุฎู ฺฉุงูุชูุฑ ุฏุฑุณุช ุณุช ูุดุฏู ู ASP.NET Core ุฑู ูพูุฑุช ุชุตุงุฏู (ูุซูุงู 8181) ุงุฌุฑุง ูโุดูุฏ
* **ุฑุงูโุญู:** Dockerfile ุฑุง ุงุตูุงุญ ฺฉุฑุฏู:

  * ุงุถุงูู ฺฉุฑุฏู `EXPOSE 80`
  * ุงุถุงูู ฺฉุฑุฏู `ENV ASPNETCORE_URLS=http://+:80`
    โ ุงู ุจุงุนุซ ุดุฏ ASP.NET Core ุญุชูุงู ุฑู ูพูุฑุช 80 ฺฏูุด ุฏูุฏ ู Azure App Service ุจุชูุงูุฏ ุชุฑุงูฺฉ ุฑุง ุจู ฺฉุงูุชูุฑ ูุฏุงุช ฺฉูุฏ
* **ูุชุฌู:** ุจุนุฏ ุงุฒ ุงุตูุงุญ Dockerfile ู ุฑุณุชุงุฑุช App Serviceุ ูุณุฑ `/api/hello` ุจุฏูู ุฎุทุง ฺฉุงุฑ ฺฉุฑุฏ

**ณ. ุฎุทุง 403 ุง App Service Stopped**

* **ุฏูู:** App Service Free F1 ูุญุฏูุฏุช instance ู ููุงุจุน ุฏุงุดุช
* **ุฑุงูโุญู:** Plan ุฑุง ุจู **B1** ุงุฑุชูุง ุฏุงุฏู ุชุง ุญุฏุงูู 1 instance ูุนุงู ุจุงุดุฏ

**ด. ุฏุณุชุฑุณ ACR (Pull) ุฎุทุง ูโุฏูุฏ / Role Assignment**

* **ุฏูู:** ฺฉุงูุชูุฑ ุงูพูฺฉุดู ุจุงูุง ููโุขูุฏ ุฒุฑุง App Service ุฏุณุชุฑุณ ูุงุฒู ุจุฑุง Pull ฺฉุฑุฏู Image ุงุฒ **Azure Container Registry (ACR)** ุฑุง ูุฏุงุดุช. ุจุฏูู ุงู ุฏุณุชุฑุณุ Authentication ุจุฑุง ฺฏุฑูุชู Docker Image ุงุฒ ACR ุงูุฌุงู ููโุดุฏ โ ฺฉุงูุชูุฑ ุงุฌุฑุง ููโุดุฏ ู Application Error ูโุฏุงุฏ.

* **ฺุฑุง ุงู ุฏุณุชุฑุณ ูุงุฒู ุงุณุชุ**

  * App Service ุจุฑุง ุงุฌุฑุง ฺฉุฑุฏู ฺฉุงูุชูุฑุ ูุงุฒ ุฏุงุฑุฏ Docker Image ุฑุง ุงุฒ ACR Pull ฺฉูุฏ
  * Managed Identity ุง Service Principal ุจุงุฏ ููุด **AcrPull** ุฏุงุดุชู ุจุงุดุฏ ุชุง ุงุฌุงุฒู ุฎูุงูุฏู Image ุฑุง ุฏุงุดุชู ุจุงุดุฏ
  * ุจุฏูู ุงู ุฏุณุชุฑุณุ App Service ููโุชูุงูุฏ Image ุฑุง ุฏุงูููุฏ ฺฉูุฏ โ ุงูพูฺฉุดู ุจุงูุง ููโุขุฏ

* **ุฑุงูโุญู ุงุฌุงุฏ ุฏุณุชุฑุณ:**

  1. ุฏุฑ **Azure Container Registry โ Access Control (IAM)**ุ ุฑู **Add role assignment** ฺฉูฺฉ ฺฉุฑุฏู
  2. Role ุฑุง **AcrPull** ุงูุชุฎุงุจ ฺฉุฑุฏู (ุงู ููุด ููุท ุงุฌุงุฒู Pull ฺฉุฑุฏู Image ุฑุง ูโุฏูุฏุ ุจุฏูู ุฏุณุชุฑุณโูุง ูุฏุฑุช)
  3. Member ุฑุง **System Assigned Identity** App Service ุฎูุฏูุงู ุงูุชุฎุงุจ ฺฉุฑุฏู
  4. ุฐุฎุฑู ุดุฏ

* **ูุชุฌู:** ุจุนุฏ ุงุฒ ุฏุงุฏู ุงู ุฏุณุชุฑุณุ App Service ุชูุงูุณุช Docker Image ุฑุง ุงุฒ ACR Pull ฺฉูุฏ ู ุงูพูฺฉุดู ุจุงูุง ุขูุฏ โ

**ต. ฺฉุงูุชูุฑ ุงุฌุฑุง ูโุดูุฏ ูู ูพูุฑุช ุงุดุชุจุงู (8080 / 8181)**

* **ุฏูู:** Dockerfile ูพูุฑุช ุตุฑุญุงู ูุดุฎุต ูุดุฏู ุจูุฏ
* **ุฑุงูโุญู:** ุงุตูุงุญ Dockerfile ุดุงูู:

  * `EXPOSE 80`
  * `ENV ASPNETCORE_URLS=http://+:80`
    โ ASP.NET Core ููุดู ุฑู ูพูุฑุช 80 ุงุฌุฑุง ุดูุฏ

**ถ. Restart ูฺฉุฑุฑ ฺฉุงูุชูุฑ ุจุนุฏ ุงุฒ ุชูุธู PORT**

* **ุฏูู:** ASP.NET Core ุฏุงุฎู ฺฉุงูุชูุฑ ูพูุฑุช ุฑุง override ูโฺฉุฑุฏ
* **ุฑุงูโุญู:** ุจุง Dockerfile ุฌุฏุฏ ู ุณุช ฺฉุฑุฏู PORT ุตุญุญ ุง Port field ุฏุฑ Container Settingsุ Restart ูฺฉุฑุฑ ุญู ุดุฏ

**ท. ุฎุทุง ูุฌุฏุฏ ุจุนุฏ ุงุฒ Build ู Push ุฌุฏุฏ**

* **ุฏูู:** ููฺฉู ุจูุฏ Container Settings ุง PORT ุชูุธู ูุดุฏู ุจุงุดุฏ
* **ุฑุงูโุญู:** ุจุนุฏ ุงุฒ ูุฑ Push ุจุฑุฑุณ ฺฉุฑุฏู Port ู Identityุ ุณูพุณ App Service Restart ุดุฏ

---

### ๐น ูฺฉุงุช ฺฉูุฏ ุฌูุนโุจูุฏ

1. Managed Identity + ACR โ ููุด **AcrPull** ุญุชูุงู ุฏุงุฏู ุดูุฏ
2. Port ุฏุงุฎู ฺฉุงูุชูุฑ ู ASP.NET Core ููุงููฺฏ ุจุงุดุฏ
3. App Service Plan ุญุฏุงูู **B1** ุจุฑุง ฺฉุงูุชูุฑ ูุงุฒู ุงุณุช
4. Dockerfile ุจุงุฏ ูพูุฑุช ุฑุง ุตุฑุญุงู `EXPOSE` ู `ASPNETCORE_URLS` ุณุช ฺฉูุฏ
5. ุจุนุฏ ุงุฒ ูุฑ ุชุบุฑ Container Settings ุง Dockerfileุ App Service ุฑุง Restart ฺฉูุฏ

---

๐ก ูุชุฌู ููุง: ุจุนุฏ ุงุฒ ุงู ุชุบุฑุงุชุ ฺฉุงูุชูุฑ **Stable ุจุงูุง ูโุขุฏ** ู ูุณุฑ:

```
http://AzureDemoApiDocker-vahidfaraji.azurewebsites.net/api/hello
```

ุจู ุฏุฑุณุช ูพุงุณุฎ `"Hello from AzureDemoApi!"` ุฑุง ูโุฏูุฏ โ

