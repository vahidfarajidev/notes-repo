# ุชูุถุญ ฺฉุงูู Dockerfile ูพุฑูฺู AzureDemoApi

ุจุงู **ูุฑ ุฎุท ุงุฒ Dockerfile** ุฑุง ูุฑุญููโุจูโูุฑุญูู ู ุจุง ุฌุฒุฆุงุช ุชูุถุญ ุจุฏูู ุชุง ุณุงุฎุชุงุฑ ู ุฏูู ูุฑ ุฏุณุชูุฑ ฺฉุงูู ูุดุฎุต ุจุงุดุฏุ ููุฑุงู ุจุง ุณูุชฺฉุณ ูุฑ ุฏุณุชูุฑ:

---

## Stage 1: Build

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
```
* **ุณูุชฺฉุณ:** `FROM <image>[:<tag>] AS <name>`
* ุงู ุฎุท ูฺฏู ฺฉู **ฺฉ Image ูพุงู ุจุณุงุฒู ุจุฑุง Build**.
* `mcr.microsoft.com/dotnet/sdk:9.0` ุดุงูู **.NET SDK 9** ุงุณุชุ ุนู ุชูุงู ุงุจุฒุงุฑูุง ุชูุณุนู ูุซู `dotnet build`, `dotnet restore`, `dotnet publish` ุฏุงุฎูุด ููุฌูุฏ ูุณุชูุฏ.
* `AS build` ูุงู ุงู ูุฑุญูู ุฑุง ูุดุฎุต ูโฺฉูุฏ ุชุง ุจุนุฏุงู ุจุชูุงูู ูุงูโูุง ุฑุง ุงุฒ ุงู ูุฑุญูู ุจู ูุฑุญููโ ุจุนุฏ ฺฉูพ ฺฉูู (**Multi-stage build**).

```dockerfile
WORKDIR /app
```
* **ุณูุชฺฉุณ:** `WORKDIR <path>`
* ูุณุฑ ฺฉุงุฑ ุฏุงุฎู ฺฉุงูุชูุฑ ุฑุง ุชุนู ูโฺฉูุฏ.
* ุฏุณุชูุฑุงุช ุจุนุฏ (`COPY`, `RUN`) ูุณุจุช ุจู ุงู ูุณุฑ ุงุฌุฑุง ูโุดููุฏ.
* ุงฺฏุฑ `/app` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ Docker ุขู ุฑุง ูโุณุงุฒุฏ.

```dockerfile
COPY *.csproj ./
```
* **ุณูุชฺฉุณ:** `COPY <src> <dest>`
* ููุท ูุงู `.csproj` ูพุฑูฺู ุฑุง ุจู ฺฉุงูุชูุฑ ฺฉูพ ูโฺฉูุฏ.
* ุฏูู ฺฉูพ ุฌุฏุงฺฏุงูู: **ุงุณุชูุงุฏู ุจููู ุงุฒ Docker cache**.
  * ุงฺฏุฑ ููุท ฺฉุฏ ุชุบุฑ ฺฉูุฏ ุงูุง ูพฺฉุฌโูุง (`NuGet packages`) ุชุบุฑ ูฺฉุฑุฏู ุจุงุดูุฏุ ูุฑุญูู `dotnet restore` ุงุฒ ฺฉุด ุงุณุชูุงุฏู ูโฺฉูุฏ ู ุณุฑุนโุชุฑ Build ูโุดูุฏ.

```dockerfile
RUN dotnet restore
```
* **ุณูุชฺฉุณ:** `RUN <command>`
* ุชูุงู **ูพฺฉุฌโูุง NuGet** ููุฑุฏ ูุงุฒ ูพุฑูฺู ุฑุง ุฏุงูููุฏ ู Cache ูโฺฉูุฏ.
* ุงู ูุฑุญูู ุชุถูู ูโฺฉูุฏ ฺฉู ุชูุงู ูุงุจุณุชฺฏโูุง ูุจู ุงุฒ Build ุขูุงุฏู ูุณุชูุฏ.

```dockerfile
COPY . ./
```
* **ุณูุชฺฉุณ:** `COPY <src> <dest>`
* ุญุงูุง ฺฉู ฺฉุฏ ูพุฑูฺู (Controllersุ Modelsุ ูุงูโูุง ู ูููุฏุฑูุง) ุฑุง ุจู ฺฉุงูุชูุฑ ฺฉูพ ูโฺฉูุฏ.
* ุงู ูุฑุญูู ุจุนุฏ ุงุฒ `restore` ุงุณุช ุชุง Docker layer cache ุจููู ุดูุฏ.

```dockerfile
RUN dotnet publish -c Release -o out
```
* **ุณูุชฺฉุณ:** `RUN <command>`
* ูพุฑูฺู ุฑุง ุฏุฑ ุญุงูุช **Release** Build ูโฺฉูุฏ.
* ุฎุฑูุฌ Publish ุฏุฑ ูุณุฑ `/app/out` ูุฑุงุฑ ูโฺฏุฑุฏ.
* ุฎุฑูุฌ ุดุงูู ุชูุงู DLL ูุงุ ูุงูโูุง ูพฺฉุฑุจูุฏ ู ููุงุจุน ูุงุฒู ุจุฑุง ุงุฌุฑุง ุงุณุช.

---

## Stage 2: Runtime

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:9.0
```
* **ุณูุชฺฉุณ:** `FROM <image>[:<tag>]`
* ุงู ูุฑุญูู ฺฉ Image ุณุจฺฉ ุจุฑุง ุงุฌุฑุง ูพุฑูฺู ุงุฌุงุฏ ูโฺฉูุฏ.
* ุดุงูู ููุท **Runtime** .NET 9 ุงุณุชุ **ูู SDK**.
* ุงุฒ ุขูุฌุง ฺฉู ูพุฑูฺู ูุจูุงู Build ู Publish ุดุฏูุ ูุงุฒ ุจู ุงุจุฒุงุฑ Build ุฏุฑ ุงู Image ูุณุช โ Image ุณุจฺฉโุชุฑ ูโุดูุฏ.

```dockerfile
WORKDIR /app
```
* **ุณูุชฺฉุณ:** `WORKDIR <path>`
* ูุณุฑ ฺฉุงุฑ Runtime.
* ูุงูโูุง Publish ุดุฏู ุงุฒ ูุฑุญูู ูุจู ุจู ุงู ูุณุฑ ฺฉูพ ูโุดููุฏ.

```dockerfile
COPY --from=build /app/out ./
```
* **ุณูุชฺฉุณ:** `COPY [--from=<name>] <src> <dest>`
* ูุงูโูุง ููุชุดุฑ ุดุฏู (`Publish`) ุงุฒ **ูุฑุญูู Build** ุฑุง ุจู ุงู Image Runtime ฺฉูพ ูโฺฉูุฏ.
* `--from=build` ูุดุฎุต ูโฺฉูุฏ ฺฉู ูุงูโูุง ุฑุง ุงุฒ ูุฑุญููโุง ฺฉู `AS build` ูุงู ุฏุงุดุช ุจุฑุฏุงุฑู.
* ุงู ุฑูุด **Multi-stage build** ุจุงุนุซ ูโุดูุฏ ููุท ูุงูโูุง ูุงุฒู ุฏุฑ Image ููุง ุจุงุดูุฏ.

```dockerfile
EXPOSE 80
```
* **ุณูุชฺฉุณ:** `EXPOSE <port>`
* ูพูุฑุช HTTP ฺฉู ฺฉุงูุชูุฑ ุฑู ุขู Listen ูโฺฉูุฏ.
* ููุช Run ูโฺฉูุ ูโุชูุงู ุงู ูพูุฑุช ุฑุง ุจู ูพูุฑุช ุฏูุฎูุงู ุณุณุชู Host ูุตู ฺฉูุ ูุซูุงู:
  ```bash
  docker run -p 8080:80 myapi:latest
  ```

```dockerfile
ENTRYPOINT ["dotnet", "AzureDemoApi.dll"]
```
* **ุณูุชฺฉุณ:** `ENTRYPOINT ["executable", "param1", ...]` ุง `ENTRYPOINT <command>`
* ุฏุณุชูุฑ ูพุดโูุฑุถ ุงุฌุฑุง ฺฉุงูุชูุฑ.
* ููุช ฺฉุงูุชูุฑ ุงุฌุฑุง ูโุดูุฏุ ุงู ุฎุท ูพุฑูฺู Publish ุดุฏู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.
* `ENTRYPOINT` ุจุงุนุซ ูโุดูุฏ ฺฉุงูุชูุฑ ุฏููุง ูุซู ุงุฌุฑุง `dotnet AzureDemoApi.dll` ุฏุฑ ุชุฑููุงู ุนูู ฺฉูุฏ.

---

### ุฌูุนโุจูุฏ

* **Stage 1: Build**
  * Build ู Publish ูพุฑูฺู ุจุง SDK
  * Cache ุจููู ุจุง ฺฉูพ ุฌุฏุงฺฏุงูู `.csproj`
  * ุฎุฑูุฌ Publish ุขูุงุฏู ุจุฑุง ุงุฌุฑุง ููุง

* **Stage 2: Runtime**
  * Image ุณุจฺฉ ููุท ุจุง Runtime
  * ูุงูโูุง Publish ุดุฏู ุงุฒ ูุฑุญูู Build ฺฉูพ ูโุดููุฏ
  * ูพูุฑุช 80 ุจุงุฒ ู ENTRYPOINT ูุดุฎุต ุงุณุช

---

๐ก ูฺฉุชู: ูโุชูุงู ุจุฑุง ุฏุฑฺฉ ุจูุชุฑ ฺฉ **Diagram ุชุตูุฑ ุณุงุฏู ุงุฒ ุงู ุฏู Stage ู ุฌุฑุงู ูุงูโูุง** ฺฉุดุฏ ุชุง ุจุจู ฺู ุงุชูุงู ุฏุงุฎู ูุฑ ูุฑุญูู ูโุงูุชุฏ.

