# EF Core: ุชูุงูุช IQueryableุ AsEnumerable ู ToList

ุงู ููุงูู ุชูุงูุชโูุง ุจู `IQueryable`ุ `AsEnumerable()` ู `ToList()` ุฏุฑ Entity Framework Core ุฑุง ุชูุถุญ ูโุฏูุฏ ู ูุญูู ุงุฌุฑุง Queryูุง ู ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู ุฑุง ุจู ุตูุฑุช ุฏูู ู ูููุฏุณ ูุดุงู ูโุฏูุฏ.

---

# โ ุญุงูุช ฑ โ ููุท `IQueryable`

```csharp
var query = dbContext.Orders
    .Where(o => o.Amount > 1000);

foreach (var order in query)
{
    Console.WriteLine(order.Id);
}
```

## ฺู ุงุชูุงู ูโุงูุชุฏุ

* ููุน `query` = `IQueryable<Order>`
* ูููุฒ Query ุงุฌุฑุง ูุดุฏู
* ููฺฏุงู ุดุฑูุน `foreach`:
  * EF Core ฺฉู expression tree ุฑุง ุจู SQL ุชุฑุฌูู ูโฺฉูุฏ
  * SQL ุงุฌุฑุง ูโุดูุฏ
  * ูุชุงุฌ stream ูโุดููุฏ

๐ ุชูุงู ููุชุฑูุง ุฏุฑ ุฏุชุงุจุณ ุงุฌุฑุง ูโุดููุฏ.

---

# โ ุญุงูุช ฒ โ ุจุง `AsEnumerable()`

```csharp
var query = dbContext.Orders
    .Where(o => o.Amount > 1000)
    .AsEnumerable();

foreach (var order in query)
{
    Console.WriteLine(order.Id);
}
```

## ฺู ุงุชูุงู ูโุงูุชุฏุ

* ูุจู ุงุฒ `AsEnumerable()` โ `IQueryable`
* ุจุนุฏ ุงุฒ ุขู โ `IEnumerable`
* ูููุฒ Query ุงุฌุฑุง ูุดุฏู โ
* ููฺฏุงู `foreach`:
  * ููุงู SQL ุณุงุฎุชู ู ุงุฌุฑุง ูโุดูุฏ

### ูฺฉุชู ููู

ุฏุฑ ุงู ูุซุงู ุฎุงุต:

```csharp
.Where(o => o.Amount > 1000)
.AsEnumerable()
```

ูฺ ุชูุงูุช ุนูู ุจุง ุญุงูุช ุงูู ูุฏุงุฑุฏุ ฺูู ููุชุฑ ูุจู ุงุฒ `AsEnumerable()` ุงุณุช ู ูููุฒ ุฏุฑ SQL ุงุฌุฑุง ูโุดูุฏ.

## ๐ฏ ูุฑู ุญุงูุช ฑ ู ฒ

ููุท ุฒูุงู ูุฑู ูโฺฉูุฏ ฺฉู ุจุนุฏ ุงุฒ `AsEnumerable()` ุงุฏุงูู LINQ ุจุฏู:

```csharp
dbContext.Orders
    .Where(o => o.Amount > 1000)  // ุฏุฑ ุฏุชุงุจุณ
    .AsEnumerable()
    .Where(o => SomeCSharpMethod(o)); // ุฏุฑ ุญุงูุธู
```

* ุดุฑุท ุงูู ุฏุฑ SQL ุงุฌุฑุง ูโุดูุฏ
* ุดุฑุท ุฏูู ุฏุฑ RAM ุงุฌุฑุง ูโุดูุฏ

ุฏุฑ ุญุงูุช ฑ ุงฺฏุฑ ูุชุฏ ูุงุจู ุชุฑุฌูู ุจู SQL ูุจุงุดุฏุ EF ุฎุทุง ูโุฏูุฏ.

---

# โ ุญุงูุช ณ โ ุจุง `ToList()`

```csharp
var list = dbContext.Orders
                    .Where(o => o.Amount > 1000)
                    .ToList();
```

## ฺู ุงุชูุงู ูโุงูุชุฏุ

* `ToList()` ููุงู ูุญุธู Query ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
* ููู ูุชุงุฌ ฺฉุงูู ุฏุงุฎู RAM ูโุขูุฏ
* ฺฉ `List<Order>` ุณุงุฎุชู ูโุดูุฏ
* ุฏฺฏุฑ Lazy ูุณุช

---

# ๐ฅ ุชูุงูุช ุงุฌุฑุง ูุงูุน

| ูฺฺฏ            | ุญุงูุช ฑ                  | ุญุงูุช ฒ                  | ุญุงูุช ณ         |
| ---------------- | ----------------------- | ----------------------- | -------------- |
| ููุน              | IQueryable              | IEnumerable             | List           |
| ุฒูุงู ุงุฌุฑุง Query | ููฺฏุงู foreach           | ููฺฏุงู foreach           | ููุงู ุฎุท ToList |
| ุงุฏุงูู LINQ ุจุนุฏุด  | ุฏุฑ SQL                  | ุฏุฑ RAM                  | ุฏุฑ RAM         |
| ฺูุฏุจุงุฑ foreach   | ูุฑ ุจุงุฑ โ ุงุฌุฑุง ูุฌุฏุฏ SQL | ูุฑ ุจุงุฑ โ ุงุฌุฑุง ูุฌุฏุฏ SQL | ููุท ุฑู ูุณุช   |

---

# โ ูฺฉุชู ุฏุฑุจุงุฑู ุงุฌุฑุง ฺูุฏุจุงุฑู

ุฏุฑ ุญุงูุช ฑ ู ฒ:

```csharp
foreach (var order in query) { }
foreach (var order in query) { }
```

โ ุฏู ุจุงุฑ Query ุงุฌุฑุง ูโุดูุฏ.

ุงูุง ุฏุฑ ุญุงูุช ณ:

```csharp
foreach (var order in list) { }
foreach (var order in list) { }
```

โ ููุท ฺฉ ุจุงุฑ Query ุงุฌุฑุง ุดุฏู.

---

# ๐ฏ ุฌูุนโุจูุฏ

* ุญุงูุช ฑ ู ฒ ุนููุงู ูุดุงุจู ูุณุชูุฏุ ูฺฏุฑ ุงูฺฉู ุจุนุฏ ุงุฒ `AsEnumerable()` ุงุฏุงูู LINQ ุฏุงุฏู ุดูุฏ
* ุญุงูุช ณ ฺฉุงููุงู ูุชูุงูุช ุงุณุชุ ฺูู materialization ููุฑ ุงูุฌุงู ูโุฏูุฏ

# ๐ง ูุฏู ุฐูู ุณุงุฏู

* `IQueryable` โ ูููุฒ SQL ุณุงุฎุชู ูโุดูุฏ
* `AsEnumerable` โ ุงุฒ ุงูุฌุง ุจู ุจุนุฏ SQL ูุณุงุฒุ LINQ ุฏุฑ ุญุงูุธู ุงุฌุฑุง ุดูุฏ
* `ToList` โ ููุงู ูุญุธู ุจุฑู ุฏุชุงุจุณ ู ููู ุฏุงุฏูโูุง ุฑุง ุจุงูุฑ

---

ุงู ููุงูู ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุชูุงูุช lazy execution ู eager execution ุฏุฑ EF Core ู ูุญูู ูุตุฑู ุญุงูุธู ู ุงุฌุฑุง Queryูุง ุฑุง ุฏุฑฺฉ ฺฉูุฏ.
